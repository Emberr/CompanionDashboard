# IgnisHealth — Self‑hosted Wellness Dashboard

IgnisHealth is a self‑hosted wellness dashboard with AI‑assisted insights. It runs as a static React app served by Nginx, with an optional API service for login and syncing your data across devices.

What’s inside
- Vite + React frontend (served by Nginx)
- Optional Node/Express API for login and data storage (JWT httpOnly cookie)
- Docker Compose stack with a persistent data volume

## Quick Start (Compose‑first)

Prerequisites: Docker with Compose, Bash

1) Create frontend envs in `.env.local` (repo root):
- `VITE_GEMINI_API_KEY=...`
- `VITE_OPENAI_API_KEY=...` (optional; voice transcription)

2) Create API credentials (writes `.env` automatically):
- `./scripts/manage.sh setup-auth admin 'your-password'`

3) Build + run both services:
- `./scripts/manage.sh deploy`
- Visit `http://localhost:5050` (or your server’s IP)

Common tasks
- Redeploy after code changes: `./scripts/manage.sh redeploy`
- Check status: `./scripts/manage.sh status`
- Tail logs: `./scripts/manage.sh logs` (or `logs app`, `logs api`)
- Diagnostics: `./scripts/manage.sh doctor` (API health + auth state)
- Stop: `./scripts/manage.sh down` (add `--purge` to delete the data volume)

## Local Development

Prerequisites: Node 20+

1) `npm install`
2) Create `.env.local` with your keys
3) `npm run dev`

## Updates

- The Compose volume `data:/app/data` keeps your data across updates.
- Use `./scripts/manage.sh redeploy` to rebuild images and restart containers.
- Avoid `./scripts/manage.sh down --purge` unless you want to wipe data.

## Data & Backups

- Data path in the API container:
  - `/app/data/store.json` (your dashboard data)
  - `/app/data/auth.json` (your account credentials)
- Backup by copying the named volume, or export the file via:
  - `./scripts/manage.sh down` (stops containers)
  - `docker run --rm -v companiondashboard_data:/v busybox tar -cz -C /v . > backup.tgz`

## Configuration

- Frontend envs (baked at build time via Vite):
  - `VITE_GEMINI_API_KEY`
  - `VITE_OPENAI_API_KEY` (optional)
- API envs (generated by setup‑auth in `.env`):
  - `AUTH_USERNAME`, `AUTH_PASSWORD_HASH` (bcrypt), `JWT_SECRET`
  - `COOKIE_SECURE` (set to `true` if serving over HTTPS)

## Authentication Flow

- On load, the app requests `/api/data`:
  - If 401: shows the login screen
  - If 200/204: proceeds and auto‑syncs changes
- Login sets an httpOnly cookie; Logout clears it.
- First‑run signup is allowed only if no credentials are configured. Otherwise, use your env‑based account.

## Troubleshooting

- Doctor: `./scripts/manage.sh doctor` (shows Compose status, `/api/health`, `/api/auth/debug`)
- API logs: `./scripts/manage.sh logs api`
- Nginx logs: `./scripts/manage.sh logs app`
- “No account configured” on login: run `setup-auth` or switch to “Create account” if `/api/auth/debug` shows `signupAllowed: true`.

## Notes on Rebranding & Data

- UI strings are rebranded to “IgnisHealth”.
- Browser localStorage key remains `aura-fit-ai-data` to avoid losing local data for existing users. Server‑synced data lives in the Compose volume and is unaffected.
